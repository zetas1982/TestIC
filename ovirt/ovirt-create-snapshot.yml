---

- hosts: localhost
  connection: local
  tasks:
   - block:
        - name: Obtain SSO token
          ovirt_auth:
               url: https://plirhapli01/ovirt-engine/api
               username: admin@internal
               password: Andorra2016
               ca_file: /tmp/ca.pem

        - name: "Paramos instancia Oracle"
          script: pararoracle.sh
          when:
              - namevm == "dlioracle01"

        - ovirt_snapshots:
                    auth: "{{ ovirt_auth }}"
                    vm_name: "{{ namevm }}"
                    description: "{{ ansible_date_time.date }}"
                    use_memory: true

        - name: " Arrancar instancia Oracle" 
          script: arrancaoracle.sh
          when:
             - namevm == "dlioracle01"



     always:
      - name: Always revoke the SSO token
        ovirt_auth:
          state: absent
          ovirt_auth: "{{ ovirt_auth }}"
